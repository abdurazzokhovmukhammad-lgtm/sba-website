<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Marketplace — SBA</title>
<style>
  :root{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:#fff;color:#111;}
  .container{max-width:1100px;margin:12px auto;padding:12px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  h1{font-size:18px;margin:0}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
  .card{border:1px solid #e6e6e6;padding:8px;border-radius:6px;display:flex;flex-direction:column}
  .thumb{width:100%;height:150px;object-fit:cover;border-radius:4px;background:#f4f4f4}
  .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
  .title{font-weight:600;font-size:14px;line-height:1.2}
  .price{font-weight:700}
  .btn{margin-top:8px;padding:8px;border:none;border-radius:6px;cursor:pointer;background:#111;color:#fff;font-size:13px}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45)}
  .modal .box{background:#fff;padding:16px;border-radius:8px;max-width:720px;width:92%;max-height:88vh;overflow:auto}
  .modal .box img{max-width:100%;height:auto;border-radius:6px}
  .modal .row{display:flex;gap:12px;flex-wrap:wrap}
  .small{font-size:13px;color:#666;margin-top:8px}
  .close{background:#f3f3f3;color:#111;padding:6px 10px;border-radius:6px;border:none;cursor:pointer}
  .empty{padding:40px;text-align:center;color:#666}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Marketplace — цифровые товары</h1>
    <div id="count">Загрузка...</div>
  </header>

  <main id="main">
    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none">Товары не найдены.</div>
  </main>
</div>

<!-- modal -->
<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="box" role="document">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong id="m-title"></strong>
      <button id="closeBtn" class="close">Закрыть</button>
    </div>
    <div class="row" style="margin-top:12px">
      <div style="flex:1">
        <img id="m-image" alt="" />
      </div>
      <div style="flex:1;min-width:220px">
        <div style="font-weight:700;margin-bottom:6px" id="m-price"></div>
        <div class="small" id="m-id"></div>
        <p style="margin-top:10px" id="m-desc"></p>
      </div>
    </div>
  </div>
</div>

<script>
/* 
  >>> ОБЯЗАТЕЛЬНО <<< 
  ЗАМЕНИ В СТРОКЕ НИЖЕ "YOUR_SHEET_ID_HERE" 
  НА ID ТВОЕЙ ГУГЛ-ТАБЛИЦЫ
  
  Пример ссылки:
  https://docs.google.com/spreadsheets/d/1iWXKluhuAVKy1UNPwxWy5mzqN0ghRqfa63Wlztz2LaI/edit#gid=0
  
  Твой SHEET_ID = 1iWXKluhuAVKy1UNPwxWy5mzqN0ghRqfa63Wlztz2LaI
*/

const SHEET_ID = "1iWXKluhuAVKy1UNPwxWy5mzqN0ghRqfa63Wlztz2LaI"; 
const SHEET_NAME = "Artifacts"; // если у тебя лист называется иначе — поменяй

async function fetchSheet(sheetId, sheetName){
  const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${encodeURIComponent(sheetName)}&tqx=out:json`;
  const res = await fetch(url);
  const text = await res.text();
  const jsonText = text.replace(/^[^\{]*\(/, '').replace(/\);?$/, '');
  const data = JSON.parse(jsonText);
  const cols = data.table.cols.map(c => (c && c.label) ? c.label : "");
  const rows = data.table.rows.map(r=>{
    const obj = {};
    r.c.forEach((cell, i)=>{
      obj[cols[i] || ("col"+i)] = cell ? cell.v : "";
    });
    return obj;
  });
  return rows;
}

function createCard(item){
  const el = document.createElement('div');
  el.className = 'card';
  const img = document.createElement('img');
  img.className = 'thumb';
  img.src = item.image_url || '';
  img.alt = item.id;
  el.appendChild(img);

  const meta = document.createElement('div');
  meta.className = 'meta';
  const title = document.createElement('div');
  title.className = 'title';
  title.textContent = item.id || 'No title';
  const price = document.createElement('div');
  price.className = 'price';
  price.textContent = item.price || '';
  meta.appendChild(title);
  meta.appendChild(price);
  el.appendChild(meta);

  const btn = document.createElement('button');
  btn.className = 'btn';
  btn.textContent = 'Подробнее';
  btn.onclick = ()=> openModal(item);
  el.appendChild(btn);
  return el;
}

function openModal(item){
  document.getElementById('m-title').textContent = item.id || '';
  document.getElementById('m-image').src = item.image_url || '';
  document.getElementById('m-price').textContent = item.price || '';
  document.getElementById('m-id').textContent = 'SBA ID: ' + (item.id || '');
  document.getElementById('m-desc').textContent = item.description || '';
  document.getElementById('modal').style.display = 'flex';
}

function closeModal(){
  document.getElementById('modal').style.display = 'none';
}

document.getElementById('closeBtn').addEventListener('click', closeModal);
document.getElementById('modal').addEventListener('click', (e)=>{
  if(e.target === document.getElementById('modal')) closeModal();
});

async function init(){
  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  try{
    const rows = await fetchSheet(SHEET_ID, SHEET_NAME);
    const items = rows.map(r => ({
      id: r['SBA ID'] || '',
      image_url: r['Image URL'] || '',
      price: r['Price'] || '',
      description: r['Description'] || '',
      status: r['Status'] || ''
    })).filter(it => it.status.toLowerCase() === 'available');

    if(items.length === 0){
      empty.style.display = 'block';
      document.getElementById('count').textContent = '0 товаров';
      return;
    }
    document.getElementById('count').textContent = items.length + ' товаров';
    grid.innerHTML = '';
    items.forEach(item=>{
      grid.appendChild(createCard(item));
    });
  }catch(err){
    console.error(err);
    empty.style.display = 'block';
    document.getElementById('count').textContent = 'Ошибка загрузки';
  }
}

init();
</script>
</body>
</html>
